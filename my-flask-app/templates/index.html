<!DOCTYPE html>
<html lang="he" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yedaarechevAI - בדיקת אמינות רכב ב-AI</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0F172A; --text-light: #E2E8F0; --primary: #6366F1; --secondary:#EC4899; }
        body {
            font-family: 'Heebo', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            overflow-x: hidden;
        }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }

        .loader { border: 3px solid rgba(255,255,255,0.2); border-top-color: var(--primary); border-radius: 50%; width: 1.5rem; height: 1.5rem; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .tab-btn {
            padding: 0.5rem 1rem; font-weight: 600; font-size: 0.875rem;
            border-bottom: 2px solid transparent; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem;
            background: transparent; color: #cbd5e1; transition: all 0.2s ease; margin-inline-end: 0.5rem;
        }
        .tab-btn:hover { color: #818cf8; border-color: rgba(99,102,241,0.3); }
        .tab-btn.active { color: #818cf8; border-color: #6366F1; background: rgba(99,102,241,0.10); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }

        .score-circle {
            width: 150px; height: 150px; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: 900; color: white; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .ltr-select { direction: ltr; text-align: left; }
        .ltr-select-wrapper .pointer-events-none { left: auto; right: 1rem; }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1', secondary: '#EC4899',
                        dark: '#0F172A', 'dark-lighter': '#1E293B',
                        success: '#10B981', warning: '#F59E0B', danger: '#EF4444',
                    },
                    boxShadow: { 'neon': '0 0 20px rgba(99, 102, 241, 0.4)' }
                }
            }
        }
    </script>
</head>
<body class="bg-dark text-slate-200 min-h-screen flex flex-col antialiased selection:bg-primary/30 selection:text-white">

    {% set active_page = 'reliability' %}
    {% include '_navbar.html' %}

    <main class="flex-grow relative container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24 flex flex-col items-center overflow-hidden">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] opacity-20 pointer-events-none"
             style="background: radial-gradient(circle, rgba(99,102,241,0.3) 0%, rgba(15,23,42,0) 70%);"></div>

        <div class="relative z-10 text-center max-w-4xl mx-auto mb-16 fade-in">
            <h2 class="text-5xl md:text-7xl font-extrabold text-white mb-8 leading-tight tracking-tight">
                בדוק את אמינות הרכב שלך 
                <span class="relative inline-block">
                    <span class="absolute inset-0 bg-gradient-to-r from-primary to-secondary blur-2xl opacity-30"></span>
                    <span class="relative text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">
                        על בסיס מודל AI מתקדם
                    </span>
                </span>
            </h2>
            <p class="text-xl md:text-2xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
                ניתוח אמינות מעמיק המבוסס על מיליוני נתונים, מותאם במיוחד לשוק הרכב הישראלי ולתנאי הארץ.
            </p>
        </div>

        <div class="relative z-10 w-full max-w-4xl bg-dark-lighter/60 backdrop-blur-xl border border-slate-700/50 p-8 md:p-12 rounded-[2.5rem] shadow-2xl fade-in delay-100">
            <div class="absolute inset-0 rounded-[2.5rem] border-2 border-transparent bg-gradient-to-br from-primary/20 via-transparent to-secondary/20 pointer-events-none" style="mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);"></div>

            {% if is_logged_in %}
            
            <!-- History Comparison Section -->
            <div class="mb-8 pb-8 border-b border-slate-700/50">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-white">השוואה מהיסטוריה</h3>
                    <button 
                        type="button"
                        id="refresh-history-btn"
                        onclick="window.loadHistoryList()"
                        class="px-3 py-1.5 text-sm bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors">
                        רענן
                    </button>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label for="history-select-1" class="block text-sm text-slate-400 mb-2">בחר חיפוש ראשון</label>
                        <select 
                            id="history-select-1" 
                            class="w-full bg-slate-900/70 border-2 border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-0 focus:border-primary transition-all">
                            <option value="">טוען היסטוריה...</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="history-select-2" class="block text-sm text-slate-400 mb-2">בחר חיפוש שני</label>
                        <select 
                            id="history-select-2" 
                            class="w-full bg-slate-900/70 border-2 border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-0 focus:border-primary transition-all">
                            <option value="">טוען היסטוריה...</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button 
                            type="button"
                            id="compare-btn"
                            onclick="window.compareHistory()"
                            class="px-6 py-3 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white font-bold rounded-xl transition-all whitespace-nowrap">
                            השווה
                        </button>
                    </div>
                </div>
                <div id="comparison-result" class="mt-6 hidden">
                    <!-- Comparison results will be inserted here -->
                </div>
            </div>
            
            <form id="car-form" class="space-y-10">
                <div class="flex items-center space-x-4 space-x-reverse border-b border-slate-700/50 pb-6">
                    <div class="bg-gradient-to-br from-primary to-secondary p-3 rounded-2xl shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white">מפרט הרכב לבדיקה</h3>
                        <p class="text-slate-400 text-sm">אנא מלא את הפרטים המדויקים ביותר לקבלת תוצאה מיטבית</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="group space-y-3">
                        <label for="make" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
                            יצרן <span class="text-secondary mr-1">*</span>
                        </label>
                        <div class="relative ltr-select-wrapper">
                            <select id="make" name="make" required
                                    class="ltr-select w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all hover:border-slate-600 cursor-pointer">
                                <option value="">Select Make...</option>
                                {% if car_models_data %}
                                    {% for make in car_models_data.keys()|sort %}
                                        <option value="{{ make }}">{{ make }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                     viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                          clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="group space-y-3">
                        <label for="model" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
                            דגם <span class="text-secondary mr-1">*</span>
                        </label>
                        <div class="relative ltr-select-wrapper">
                            <select id="model" name="model" required disabled
                                    class="ltr-select w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <option value="">-- Select Make First --</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                     viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                          clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="group space-y-3">
                        <label for="year" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
                            שנתון <span class="text-secondary mr-1">*</span>
                        </label>
                        <div class="relative ltr-select-wrapper">
                            <select id="year" name="year" required disabled
                                    class="ltr-select w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <option value="">-- Select Model First --</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                     viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                          clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/30 p-6 rounded-2xl border border-slate-700/50 space-y-6">
                    <h4 class="text-lg font-bold text-white flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-primary"
                             viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                  d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01-.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                                  clip-rule="evenodd" />
                        </svg>
                        דיוק נתונים (אופציונלי)
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">קילומטראז'</label>
                            <select id="mileage_range" name="mileage_range"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                                <option>עד 50,000 ק"מ</option>
                                <option>50,000 - 100,000 ק"מ</option>
                                <option selected>100,000 - 150,000 ק"מ</option>
                                <option>150,000 - 200,000 ק"מ</option>
                                <option>מעל 200,000 ק"מ</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">סוג מנוע</label>
                            <select id="fuel_type" name="fuel_type"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                                <option selected>בנזין</option>
                                <option>דיזל</option>
                                <option>היברידי (רגיל/פלאג-אין)</option>
                                <option>חשמלי מלא (BEV)</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">תיבת הילוכים</label>
                            <select id="transmission" name="transmission"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                                <option selected>אוטומטית (פלנטרית/רציפה)</option>
                                <option>רובוטית (כפולת מצמדים)</option>
                                <option>ידנית</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label for="sub_model"
                               class="text-xs font-bold uppercase tracking-wider text-slate-400">
                            רמת גימור / תת-דגם
                        </label>
                        <input type="text" id="sub_model" name="sub_model"
                               placeholder="לדוגמה: Premium, Sport, GLI, 1.5 Turbo..."
                               class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary focus:border-primary placeholder-slate-600 text-right"
                               dir="rtl">
                    </div>
                </div>

                <div class="bg-slate-800/30 p-6 rounded-2xl border border-slate-700/50 space-y-6">
                    <h4 class="text-lg font-bold text-white flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-primary" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 3a3 3 0 00-3 3v2a3 3 0 003 3h2a3 3 0 013 3v2a3 3 0 003 3h2a3 3 0 003-3v-2a3 3 0 00-3-3h-2a3 3 0 01-3-3V6a3 3 0 00-3-3H5z" clip-rule="evenodd" />
                        </svg>
                        פרופיל שימוש אישי (חדש)
                    </h4>
                    <p class="text-xs text-slate-400">התאמת הניתוח לנסועה, אופי נהיגה ואקלים. ערכי ברירת מחדל בטוחים מוגדרים מראש.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">נסועה שנתית (ק״מ)</label>
                            <input id="annual_km" name="annual_km" type="number" min="0" max="60000" step="500" value="15000"
                                   class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">% נסיעה עירונית</label>
                            <input id="city_pct" name="city_pct" type="number" min="0" max="100" step="5" value="50"
                                   class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">נהג / עומס</label>
                            <select id="driver_style" name="driver_style"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary">
                                <option value="calm">רגוע</option>
                                <option value="normal" selected>רגיל</option>
                                <option value="aggressive">אגרסיבי</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">טופוגרפיה</label>
                            <select id="terrain" name="terrain"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary">
                                <option value="flat">מישורית</option>
                                <option value="mixed" selected>מעורבת</option>
                                <option value="hilly">הררית</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">אקלים</label>
                            <select id="climate" name="climate"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary">
                                <option value="center" selected>מרכז</option>
                                <option value="coastal">חופי</option>
                                <option value="north">צפון</option>
                                <option value="south_hot">דרום חם</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">חניה קבועה</label>
                            <select id="parking" name="parking"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary">
                                <option value="outdoor" selected>חוץ</option>
                                <option value="covered">מקורה</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wider text-slate-400">עומס רכב</label>
                            <select id="load" name="load"
                                    class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary">
                                <option value="light">קל</option>
                                <option value="family" selected>משפחתי</option>
                                <option value="heavy">כבד</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="pt-4 space-y-8">
                    <label
                        class="flex items-start gap-4 p-4 rounded-xl bg-slate-800/20 border border-slate-700/50 cursor-pointer group hover:bg-slate-800/40 transition-colors">
                        <input type="checkbox" id="legal-confirm" name="legal-confirm" required
                               class="mt-1 w-6 h-6 rounded border-2 border-slate-600 text-primary focus:ring-offset-0 focus:ring-primary bg-slate-900/50 checked:bg-primary transition-colors">
                        <span class="text-sm text-slate-300 leading-relaxed">
                            אני מאשר/ת כי אני מעל גיל 18, וקראתי והסכמתי
                            <a href="{{ url_for('public.terms') }}" target="_blank"
                               class="text-primary font-bold hover:underline underline-offset-4">לתנאי השימוש</a>
                            ו
                            <a href="{{ url_for('public.privacy') }}" target="_blank"
                               class="text-primary font-bold hover:underline underline-offset-4">מדיניות הפרטיות</a>
                            של האתר.
                        </span>
                    </label>
                    <p id="legal-error"
                       class="hidden flex items-center text-red-400 text-sm bg-red-950/30 border border-red-900/50 p-3 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                                  clip-rule="evenodd" />
                        </svg>
                        אנא אשר/י את תנאי השימוש כדי להמשיך בתהליך.
                    </p>

                    <button type="submit" id="submit-button"
                            class="relative w-full md:w-auto md:min-w-[360px] mx-auto flex items-center justify-center py-5 px-10 bg-gradient-to-r from-primary to-secondary hover:from-primary/110 hover:to-secondary/110 text-white font-black text-xl rounded-2xl shadow-xl shadow-primary/20 transition-all hover:scale-[1.02] active:scale-95 overflow-hidden group">
                        <span
                            class="absolute inset-0 w-full h-full bg-white/20 group-hover:w-0 transition-all duration-500 ease-out opacity-0 group-hover:opacity-100"></span>
                        <span class="button-text relative z-10 flex items-center">הפעל מנוע ניתוח AI</span>
                        <div class="spinner hidden relative z-10 mr-3" aria-hidden="true">
                            <div class="loader"></div>
                        </div>
                    </button>
                </div>
            </form>
            {% else %}
            <div class="text-center py-8 space-y-8">
                <div class="relative inline-block">
                    <div class="absolute inset-0 bg-primary/30 blur-3xl rounded-full"></div>
                    <div
                        class="relative bg-dark-lighter p-6 rounded-3xl border border-slate-700/50 shadow-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                </div>
                <div>
                    <h3 class="text-3xl font-bold text-white mb-4">התחבר כדי להמשיך</h3>
                    <p class="text-slate-400 text-lg max-w-md mx-auto">
                        התחבר עם חשבון Google שלך כדי לגשת למערכת.
                    </p>
                </div>
                <a href="{{ url_for('public.login') }}"
                   class="group relative inline-flex items-center justify-center px-10 py-5 text-xl font-bold text-white transition-all duration-300 bg-gradient-to-r from-primary to-secondary rounded-2xl hover:scale-[1.03] hover:shadow-neon active:scale-95 overflow-hidden">
                    <span
                        class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full"></span>
                    <svg class="w-7 h-7 ml-3" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.9 8.2,4.73 12.2,4.73C15.29,4.73 17.1,6.7 17.1,6.7L19,4.72C19,4.72 16.56,2 12.1,2C6.42,2 2.03,6.8 2.03,12C2.03,17.05 6.16,22 12.25,22C17.6,22 21.5,18.33 21.5,12.91C21.5,11.76 21.35,11.1 21.35,11.1V11.1Z" />
                    </svg>
                    התחברות מהירה עם Google
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Timing Banner (hidden by default) -->
        <div id="timingBanner" class="hidden fixed top-24 left-1/2 transform -translate-x-1/2 z-50 bg-dark-lighter/95 backdrop-blur-xl border-2 border-primary/50 rounded-2xl shadow-2xl p-6">
            <div class="flex flex-col items-center gap-4">
                <div class="relative w-32 h-32">
                    <!-- SVG Circular Progress Ring -->
                    <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="54" fill="none" stroke="#1e293b" stroke-width="8"></circle>
                        <circle id="progressRing" cx="60" cy="60" r="54" fill="none" stroke="url(#rainbowGradient)" stroke-width="8" 
                                stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                style="transition: stroke-dashoffset 0.3s ease, stroke 0.5s ease;"></circle>
                        <defs>
                            <linearGradient id="rainbowGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:rgb(255,0,0);stop-opacity:1" />
                                <stop offset="16.67%" style="stop-color:rgb(255,165,0);stop-opacity:1" />
                                <stop offset="33.33%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
                                <stop offset="50%" style="stop-color:rgb(0,255,0);stop-opacity:1" />
                                <stop offset="66.67%" style="stop-color:rgb(0,127,255);stop-opacity:1" />
                                <stop offset="83.33%" style="stop-color:rgb(139,0,255);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:rgb(255,0,0);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <!-- Center Text (elapsed time) -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="elapsedTime" class="text-3xl font-black text-white">0</span>
                    </div>
                </div>
                <div class="text-center">
                    <div id="etaText" class="text-sm text-slate-300 font-medium"></div>
                    <div id="statusText" class="text-xs text-slate-400 mt-1">מעבד...</div>
                </div>
            </div>
        </div>

        <div id="results-container" class="hidden w-full max-w-5xl mt-16 fade-in delay-300">
                <div
                    class="bg-dark-lighter/80 backdrop-blur-xl p-6 md:p-8 rounded-[2rem] border border-slate-700/50 shadow-2xl text-slate-200">
                    <div id="reliability-score-container"
                         class="flex flex-col items-center justify-center mb-10 text-center"></div>


                    <div class="flex flex-wrap border-b border-slate-700 mb-6 overflow-x-auto">
                        <button class="tab-btn active" onclick="window.openTab(event, 'summary')">סיכום מנהלים</button>
                        <button class="tab-btn" onclick="window.openTab(event, 'faults')">תקלות נפוצות</button>
                        <button class="tab-btn" onclick="window.openTab(event, 'costs')">עלויות אחזקה</button>
                    <button class="tab-btn" onclick="window.openTab(event, 'report')">דוח אמינות</button>
                    <button class="tab-btn" onclick="window.openTab(event, 'competitors')">מתחרים</button>
                </div>

                <div id="summary" class="tab-content active prose prose-invert max-w-none">
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-white">סיכום אמינות – הסבר פשוט</h3>
                        <p id="summary-simple-text" class="text-slate-200 leading-relaxed"></p>

                        <button
                            id="summary-toggle-btn"
                            type="button"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold bg-slate-800 hover:bg-slate-700 text-slate-100 border border-slate-600 transition-colors">
                            להרחבה מקצועית
                        </button>

                        <div id="summary-detailed-block" class="mt-4 hidden space-y-2">
                            <h4 class="text-sm font-bold text-slate-300">הסבר מקצועי ומעמיק</h4>
                            <p id="summary-detailed-text"
                               class="text-slate-300 text-sm leading-relaxed"></p>
                        </div>

                        <div id="sources-block" class="mt-4 space-y-2">
                            <h4 class="text-sm font-bold text-slate-300 flex items-center gap-2">
                                מקורות החיפוש
                            </h4>
                            <ul id="sources-list" class="list-disc list-inside text-sm text-slate-200 space-y-1"></ul>
                        </div>
                    </div>
                </div>

                <div id="faults" class="tab-content prose prose-invert max-w-none"></div>
                <div id="costs" class="tab-content prose prose-invert max-w-none"></div>
                <div id="report" class="tab-content prose prose-invert max-w-none"></div>
                <div id="competitors" class="tab-content prose prose-invert max-w-none"></div>
            </div>
        </div>
    </main>

    <footer class="mt-32 py-12 text-center border-t border-slate-800/50 bg-dark-lighter/30 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3 opacity-75 hover:opacity-100 transition-opacity">
                <span class="font-bold text-white">yedaarechevAI</span>
            </div>
            <p class="text-slate-500 text-sm">© 2025 ידע רכב.</p>
            <div class="flex gap-6 text-sm font-medium">
                <a href="{{ url_for('public.privacy') }}" class="text-slate-400 hover:text-primary transition-colors">
                    מדיניות פרטיות
                </a>
                <a href="{{ url_for('public.terms') }}" class="text-slate-400 hover:text-primary transition-colors">
                    תקנון שימוש
                </a>
            </div>
        </div>
    </footer>

    <!-- דגלים לסקריפט -->
    <script type="application/json" id="auth-data">
        {% if is_logged_in %}true{% else %}false{% endif %}
    </script>
    <script type="application/json" id="car-data">
        {{ car_models_data | tojson | safe }}
    </script>

    <script src="/static/script.js"></script>
</body>
</html>
